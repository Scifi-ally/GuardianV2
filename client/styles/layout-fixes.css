/* Layout Fixes for Button Overlapping and UI Conflicts */

/* ============================================
   NAVIGATION BAR HEIGHT CALCULATIONS
   ============================================ */

:root {
  /* Calculate actual navbar height including safe areas */
  --navbar-height: calc(64px + env(safe-area-inset-bottom, 0px));
  --navbar-height-mobile: calc(60px + env(safe-area-inset-bottom, 0px));

  /* Content bottom padding to prevent overlap */
  --content-bottom-padding: calc(var(--navbar-height) + 16px);
  --content-bottom-padding-mobile: calc(var(--navbar-height-mobile) + 16px);
}

/* ============================================
   MAIN CONTENT SPACING FIXES
   ============================================ */

/* Fix page content bottom spacing to prevent navbar overlap */
.page-content-spacing {
  padding-bottom: var(--content-bottom-padding);
}

@media (max-width: 768px) {
  .page-content-spacing {
    padding-bottom: var(--content-bottom-padding-mobile);
  }
}

/* Dynamic bottom spacing utility class */
.safe-bottom-spacing {
  padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
}

/* ============================================
   SLIDE UP PANEL FIXES
   ============================================ */

/* Ensure slide up panel doesn't overlap with navbar */
.slide-panel-safe-bottom {
  bottom: var(--navbar-height);
}

@media (max-width: 768px) {
  .slide-panel-safe-bottom {
    bottom: var(--navbar-height-mobile);
  }
}

/* ============================================
   BUTTON SPACING AND OVERLAP PREVENTION
   ============================================ */

/* Prevent button overlap in grid layouts */
.button-grid-safe {
  display: grid;
  gap: 0.5rem;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
}

@media (max-width: 640px) {
  .button-grid-safe {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
}

/* Prevent stacked button overlap */
.button-stack-safe > button + button {
  margin-top: 0.75rem;
}

@media (max-width: 640px) {
  .button-stack-safe > button + button {
    margin-top: 1rem;
  }
}

/* ============================================
   CARD LAYOUT FIXES
   ============================================ */

/* Prevent card content from overlapping with fixed elements */
.card-content-safe {
  margin-bottom: 1rem;
}

/* Card grid that prevents overlap on small screens */
.card-grid-responsive {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
}

@media (max-width: 640px) {
  .card-grid-responsive {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
}

/* ============================================
   DIALOG AND MODAL FIXES
   ============================================ */

/* Ensure dialogs don't overlap with fixed navigation */
.dialog-safe-positioning {
  max-height: calc(100vh - var(--navbar-height) - 2rem);
  margin-bottom: var(--navbar-height);
}

@media (max-width: 768px) {
  .dialog-safe-positioning {
    max-height: calc(100vh - var(--navbar-height-mobile) - 1rem);
    margin-bottom: var(--navbar-height-mobile);
  }
}

/* ============================================
   SEARCH BAR POSITIONING
   ============================================ */

/* Ensure search bar doesn't overlap with status bar or content */
.search-bar-safe-top {
  top: calc(env(safe-area-inset-top, 0px) + 1rem);
  z-index: 1000;
}

/* Prevent search bar from being too close to navbar */
.search-bar-safe-bottom {
  margin-bottom: calc(var(--navbar-height) + 1rem);
}

/* ============================================
   EMERGENCY BUTTON POSITIONING
   ============================================ */

/* Ensure emergency buttons are always accessible */
.emergency-button-safe {
  position: fixed;
  z-index: 9999;
  bottom: calc(var(--navbar-height) + 1rem);
  right: 1rem;
  min-width: 60px;
  min-height: 60px;
}

@media (max-width: 768px) {
  .emergency-button-safe {
    bottom: calc(var(--navbar-height-mobile) + 1rem);
    min-width: 56px;
    min-height: 56px;
  }
}

/* ============================================
   PROFILE PAGE SPECIFIC FIXES
   ============================================ */

/* Profile grid that prevents button overlap */
.profile-action-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 1rem;
}

@media (max-width: 640px) {
  .profile-action-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }
}

@media (max-width: 480px) {
  .profile-action-grid {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
}

/* ============================================
   FORM ELEMENT FIXES
   ============================================ */

/* Prevent form elements from being hidden behind navbar */
.form-safe-spacing {
  padding-bottom: calc(var(--navbar-height) + 2rem);
}

/* Form button container that prevents overlap */
.form-button-container {
  position: sticky;
  bottom: calc(var(--navbar-height) + 1rem);
  background: linear-gradient(transparent, white 20%);
  padding: 1rem 0 2rem 0;
  margin-top: 2rem;
}

/* ============================================
   TAB NAVIGATION FIXES
   ============================================ */

/* Ensure tab content doesn't get cut off */
.tab-content-safe {
  max-height: calc(100vh - var(--navbar-height) - 8rem);
  overflow-y: auto;
  padding-bottom: 2rem;
}

/* ============================================
   SCROLL CONTAINER FIXES
   ============================================ */

/* Safe scrolling that accounts for fixed elements */
.scroll-container-safe {
  height: calc(100vh - var(--navbar-height) - 2rem);
  overflow-y: auto;
  padding-bottom: 1rem;
}

@media (max-width: 768px) {
  .scroll-container-safe {
    height: calc(100vh - var(--navbar-height-mobile) - 1rem);
  }
}

/* ============================================
   LANDSCAPE MODE FIXES
   ============================================ */

@media screen and (orientation: landscape) and (max-height: 500px) {
  /* Reduce spacing in landscape to prevent overlap */
  .landscape-compact-spacing {
    padding-bottom: calc(var(--navbar-height) / 2);
  }

  /* Compact button layout for landscape */
  .button-grid-safe {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 0.25rem;
  }

  /* Reduce dialog margins in landscape */
  .dialog-safe-positioning {
    max-height: calc(100vh - 1rem);
    margin-bottom: 1rem;
  }
}

/* ============================================
   LOADING STATE FIXES
   ============================================ */

/* Ensure loading states don't overlap with navigation */
.loading-overlay-safe {
  bottom: var(--navbar-height);
  top: 0;
  position: fixed;
  width: 100%;
  z-index: 999;
}

/* ============================================
   NOTIFICATION POSITIONING
   ============================================ */

/* Position notifications above navbar */
.notification-safe-position {
  bottom: calc(var(--navbar-height) + 1rem);
  z-index: 1001;
}

/* ============================================
   UTILITY CLASSES FOR DYNAMIC ADJUSTMENTS
   ============================================ */

/* Class to add when keyboard is open (mobile) */
.keyboard-open .page-content-spacing {
  padding-bottom: 1rem;
}

/* Class for emergency mode layouts */
.emergency-mode .safe-bottom-spacing {
  padding-bottom: calc(120px + env(safe-area-inset-bottom, 0px));
}

/* High contrast mode adjustments */
.high-contrast .button-grid-safe {
  gap: 1rem;
}

.high-contrast .card-grid-responsive {
  gap: 1.5rem;
}

/* ============================================
   ACCESSIBILITY IMPROVEMENTS
   ============================================ */

/* Ensure focus indicators are visible above overlapping content */
.focus-visible-safe:focus-visible {
  z-index: 10001;
  position: relative;
}

/* Screen reader safe positioning */
.sr-only-safe {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}
